"use strict";var WPFormsBuilderFormLocker=window.WPFormsBuilderFormLocker||function(e,s){var n={scheduling:{start:{$dpicker:s("#wpforms-panel-field-settings-form_locker_schedule_start_date"),$tpicker:s("#wpforms-panel-field-settings-form_locker_schedule_start_time")},end:{$dpicker:s("#wpforms-panel-field-settings-form_locker_schedule_end_date"),$tpicker:s("#wpforms-panel-field-settings-form_locker_schedule_end_time")}}},l={init:function(){s(l.ready)},ready:function(){l.events(),l.conditionals(),l.selectConditionals(),l.emailDropdownToggle(),l.dateTimePicker(),l.scheduleDatetimeEvents()},events:function(){s(e).on("click",".wpforms-panel-field-datetime .wpforms-clear-datetime-field",l.resetDateTimeField),s(e).on("change","#wpforms-panel-field-settings-form_locker_verification, #wpforms-panel-field-settings-form_locker_verification_type",l.selectConditionals),s(e).on("change","#wpforms-panel-field-settings-form_locker_user_entry_limit_enable, #wpforms-panel-field-settings-form_locker_user_entry_restrict_by_email",l.emailDropdownToggle),s(e).on("wpformsSaved",l.requireUserEntryLimitRestrictBy)},resetDateTimeField:function(){var e=s(this).siblings("input");e.prop("_flatpickr")?e.prop("_flatpickr").clear():e.val(""),s(this).hide()},conditionals:function(){void 0!==s.fn.conditions&&s.each([{id:"#wpforms-panel-field-settings-form_locker_verification",hides:"#wpforms-panel-field-settings-form_locker_verification_type-wrap"},{id:"#wpforms-panel-field-settings-form_locker_schedule_enable",hides:"#wpforms-form-locker-schedule-datetime-block,#wpforms-panel-field-settings-form_locker_schedule_message-wrap"},{id:"#wpforms-panel-field-settings-form_locker_user_enable",hides:"#wpforms-panel-field-settings-form_locker_user_message-wrap"},{id:"#wpforms-panel-field-settings-form_locker_entry_limit_enable",hides:"#wpforms-panel-field-settings-form_locker_entry_limit-wrap,#wpforms-panel-field-settings-form_locker_entry_limit_message-wrap"},{id:"#wpforms-panel-field-settings-form_locker_user_entry_limit_enable",hides:"#wpforms-panel-field-settings-form_locker_user_entry_restrict_by_ip-wrap,#wpforms-panel-field-settings-form_locker_user_entry_restrict_by_email-wrap,#wpforms-panel-field-settings-form_locker_user_entry_message_limited-wrap,.wpforms-form-locker-user-entry-container,#wpforms-panel-field-settings-form_locker_user_entry_email_field-wrap"}],function(e,t){s(t.id).conditions({conditions:{element:t.id,type:"checked",operator:"is"},actions:{if:{element:t.hides,action:"show"},else:{element:t.hides,action:"hide"}},effect:"appear"})})},selectConditionals:function(){var e=s("#wpforms-panel-field-settings-form_locker_verification_type"),t=e.find("option"),r=e.val(),i=s("#wpforms-panel-field-settings-form_locker_verification").is(":checked");t.length&&t.each(function(){var e=s(this).val();i&&e===r||s(".wpforms-form-locker-"+e).hide(),i&&e===r&&s(".wpforms-form-locker-"+e).show()})},emailDropdownToggle:function(){var e=s("#wpforms-panel-field-settings-form_locker_user_entry_restrict_by_email"),t=s("#wpforms-panel-field-settings-form_locker_user_entry_email_field-wrap"),r=s("#wpforms-panel-field-settings-form_locker_user_entry_limit_enable").is(":checked");e.length&&(e.is(":checked")&&r?t.show():t.hide())},requireUserEntryLimitRestrictBy:function(){var e,t=s("#wpforms-panel-field-settings-form_locker_user_entry_limit_enable");t&&t.is(":checked")&&(t=s("#wpforms-panel-field-settings-form_locker_user_entry_restrict_by_ip"),e=s("#wpforms-panel-field-settings-form_locker_user_entry_restrict_by_email"),t.is(":checked")||e.is(":checked")||s.alert({title:wpforms_builder.heads_up,content:wpforms_admin_builder_form_locker.require_restrict_user_entry_option,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}}))},dateTimePicker:function(){l.datePicker(),l.timePicker(),l.datePair(),l.dateTimeClearBtnsInit()},datePicker:function(){void 0!==s.fn.flatpickr&&(s("#wpforms-panel-field-settings-form_locker_schedule_start_date").flatpickr(l.datePickerGetArgs("start")),s("#wpforms-panel-field-settings-form_locker_schedule_end_date").flatpickr(l.datePickerGetArgs("end")))},timePicker:function(){var e,t,r;void 0!==s.fn.timepicker&&(e={appendTo:s("#wpforms-builder"),disableTextInput:!0,timeFormat:wpforms_admin_builder_form_locker.time_format},t=s("#wpforms-panel-field-settings-form_locker_schedule_start_time"),r=s("#wpforms-panel-field-settings-form_locker_schedule_end_time"),t.timepicker(e).on("selectTime",l.dateTimeClearBtnsRefresh),r.timepicker(e).on("selectTime",l.dateTimeClearBtnsRefresh))},datePair:function(){var e={anchor:null,defaultDateDelta:0,defaultTimeDelta:18e5,dateClass:"wpforms-datepair-date",timeClass:"wpforms-datepair-time",startClass:"wpforms-datepair-start",endClass:"wpforms-datepair-end",parseDate:function(e){return s(e).prop("_flatpickr").selectedDates[0]},updateDate:function(e,t){e=s(e);e.prop("_flatpickr").setDate(t),l.dateTimeClearBtnsRefresh(e),e.trigger("change")},updateTime:function(e,t){e=s(e);e.timepicker("setTime",t),l.dateTimeClearBtnsRefresh(e),e.trigger("change")}};s("#wpforms-form-locker-schedule-datetime-block").datepair(e)},dateTimeClearBtnsInit:function(){s("#wpforms-form-locker-schedule-datetime-block .wpforms-clear-datetime-field").each(function(){var e=s(this);""===e.siblings('[id^="wpforms-panel-field-settings-form_locker_schedule_"]').val()&&e.hide()})},dateTimeClearBtnsRefresh:function(e){(e=e.target?s(e.target):e)&&""!==e.val()&&e.nextAll("button.wpforms-clear-datetime-field").show()},datePickerGetArgs:function(r){r="start"===r?"start":"end";var i=n.scheduling[r].$tpicker,s=n.scheduling[r].$dpicker,e={altInput:!0,altFormat:wpforms_admin_builder_form_locker.date_format,dateFormat:"Y-m-d",onChange:function(e){var t={field:"start"===r?"end":"start"};t.$dpicker=n.scheduling[t.field].$dpicker,t.$tpicker=n.scheduling[t.field].$tpicker,""===i.val()&&""===t.$tpicker.val()&&i.timepicker("setTime",new Date(e)),l.dateTimeClearBtnsRefresh(i),l.dateTimeClearBtnsRefresh(s)}};return e},scheduleDatetimeEvents:function(){s("#wpforms-form-locker-schedule-datetime-block").on("change","input",function(e){var t=n.scheduling.start.$dpicker.val(),r=n.scheduling.start.$tpicker.val(),i=n.scheduling.end.$dpicker.val(),s=n.scheduling.end.$tpicker.val();""===t||""===i||(t=(t+" "+r).replace(/-/g,"/"),r=(i+" "+s).replace(/-/g,"/"),i=new Date(t),new Date(r).getTime()>i.getTime())||(i.setMinutes(i.getMinutes()+30),n.scheduling.end.$tpicker.timepicker("setTime",i),n.scheduling.end.$dpicker.prop("_flatpickr").setDate(i),l.dateTimeClearBtnsRefresh(n.scheduling.end.$tpicker),l.dateTimeClearBtnsRefresh(n.scheduling.end.$dpicker))})}};return l}(document,(window,jQuery));WPFormsBuilderFormLocker.init();